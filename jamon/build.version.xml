<?xml version="1.0"?>
<project name="svn-version">
  <target name="svn-versioning">
    <property name="svn.override.property" value="ignore.svn"/>
    <property name="svn.version.dir" value="."/>
    <exec executable="svnversion" outputproperty="svn.version">
      <arg value="${svn.version.dir}"/>
    </exec>
    <condition property="mixed.svn.versions">
      <and>
        <contains string="${svn.version}" substring=":"/>
        <not><isset property="${svn.override.property}"/></not>
      </and>
    </condition>
    <fail if="${mixed.svn.versions}" message="do an svn update (or -D${svn.override.property}=true)"/>
    <condition property="svn.modified">
      <and>
        <contains string="${svn.version}" substring="M"/>
        <not><isset property="${svn.override.property}"/></not>
      </and>
    </condition>
    <fail if="svn.modified" message="do an svn commit (or -D${svn.override.property}=true)"/>
    <filterset id="svn.version">
      <filter token="SVN_VERSION" value="${svn.version}"/>
    </filterset>
  </target>
</project>
