<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Jamon User's Guide</title>
    <style type="text/css" media="screen">
    <!--
      pre { margin-left: 5em; margin-right: 5em; padding: 0.5em; border: solid; border-width: thin }
      pre.template { background-color: #efffdf }
      pre.code { background-color: #ffdfdf }
      pre.tty { background-color: #e0e0e0;  }
      li { padding-top: 0.5em }
      .concept { font-weight: bold; display: block; padding-bottom: 0.5em }
    -->
    </style>
  </head>

  <body>
    <h1>Jamon User's Guide</h1>

    <h2>Jamon templates</h2>

    <ol>

      <li><span class="concept">Static content</span>

        In general, any characters appearing in a template are output
        literally, whitespace included.

      <li><span class="concept">Java escapes</span>

        The value of a java expression can be emitted by enclosing the
        expression in <code>&lt;%...%&gt;</code> pairs, e.g.
        <pre class="template">
&lt;% person.getFirstName().substring(0,10) %&gt;
</pre>

        <p>
          Arbitrary Java code can be inserted into the template using
          <code>&lt;%java&gt;...&lt;/%java&gt;</code>, e.g.
        <pre class="template">
&lt;%java&gt;
  while (iter.hasNext()) {
    Person p = (Person) iter.next();
    if (p.getLastName().startsWith("S")) {
&lt;/%java&gt;
      &lt;% p.getLastName() %&gt;'s last name doesn't start with 'X'.
&lt;%java&gt;
    }
  }
&lt;/%java&gt;
</pre>
        Alternatively, any line beginning with '<code>%</code>' also is
        assumed to contain valid Java code. The previous example could
        be equivalently (and perhaps more clearly) written as
        <pre class="template">
%  while (iter.hasNext()) {
%    Person p = (Person) iter.next();
%    if (p.getLastName().startsWith("S")) {
      &lt;% p.getLastName() %&gt;'s last name doesn't start with 'X'.
%    }
%  }
</pre>
    <p>

      The kinds of Java code that can appear in an escape is fairly
      unrestricted. Be warned, however, that code is emitted inside a
      method body. Thus, for example, package declarations and import
      statements would trigger a compilation error.

    <li><span class="concept">Comments</span>

      Any template content between <code>&lt;%doc&gt;</code> and
      <code>&lt;/%doc&gt;</code> is considered "documentation", and
      ignored by the template processor

    <li><span class="concept">Imports</span>

      Java classes or packages to be imported and used in a template
      should be placed inside an <code>&lt;%import&gt;</code>
      block. Each package or class should appear on a new line,
      optionally separated by a semicolon ('<code>;</code>').
      <p>
      For example:
      <pre class="template">
&lt;%import&gt;
  java.util.Iterator
  org.modusponens.myapp.data.*
&lt;/%import&gt;
</pre>

    <li><span class="concept">Arguments</span>

      Arguments to a template are specified in
      <code>&lt;%args&gt;</code> ... <code>&lt;/%args&gt;</code>
      blocks. Each argument consists of a type followed by the
      argument name, optionally followed by <code>=&gt;</code> and a
      default value. Each argument must appear on a separate line, and
      each argument declaration must be terminated by a semicolon.

    <p>
      Arguments are usable inside any (top-level) java escape or java
      expression in the template. Technically, they are declared
      "<code>final</code>", so it is not possible to (re)assign a
      value to a template argument.

    <p>
      For example:
      <pre class="template">
&lt;%args&gt;
  String[] nicknames => new String[0];
  Address address;
  java.util.Iterator friends;
&lt;/%args&gt;
Your nicknames are
&lt;ul&gt;
% for (int i = 0; i &lt; nicknames.length; ++i) {
    &lt;li&gt; &lt;% nicknames[i] %&gt;
% }
&lt;/ul&gt;
% while (friends.hasNext()) {
%   Person p = (Person) friends.next();
%   if (p.getAddress().getPostalCode().equals(address.getPostalCode())) {
      Hey, guess what? &lt;% p.getName() %&gt; lives close by!
%   }
% }
</pre>
    Note that for this template to compile, the <code>Address</code>
    class would need to appear in an <code>&lt;%import&gt;</code>
    block.
        <p>
          Arguments with default values are optional, and need not be
          specified when invoking a template. At the top-level
          (i.e. the interface to "standard" java code), optional
          arguments are implemented as "setters" on the template
          object rather than as arguments to the <code>render</code>
          method.

    <li><span class="concept">Private template methods</span>

      Private template methods ("<def>defs</def>") can be declared via
      the <code>&lt;%def <i>def-name</i>&gt;</code>
      instruction. Defs may be declared to accept arguments similar to
      templates by using <code>%args</code>.
        <p>
          Methods can be invoked via the <code>&lt;&amp;
          <i>def-name</i>; argument1; ... &amp;&gt;</code>
          construct.
        <p>
          For example:
        <pre class="template">
&lt;%def _row&gt;
  &lt;%args&gt;
    String name;
    int age;
  &lt;/%args&gt;
  &lt;tr&gt;
    &lt;td align="left"&gt;&lt;% name %&gt;&lt;/td&gt;
    &lt;td&gt;&nbsp;&lt;/td&gt;
    &lt;td align="center"
%     if (age &lt; 18) {
        bgcolor="red"
%     }
    &gt;
      &lt;% age %&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
&lt;/%def&gt;

&lt;table&gt;
  &lt;&amp; _row; name =&gt; "Mickey"; age =&gt; 46 &amp;&gt;
  &lt;&amp; _row; name =&gt; "Junior"; age =&gt; 8 &amp;&gt;
  &lt;&amp; _row; name =&gt; "Minnie"; age =&gt; 25 &amp;&gt;
&lt;/table&gt;
</pre>
        produces
        <pre class="tty">
&lt;table&gt;
  &lt;tr&gt;
    &lt;td align="left"&gt;Mickey&lt;/td&gt;
    &lt;td&gt;&amp;nbsp;&lt;/td&gt;
    &lt;td align="center"
    &gt;
      46
    &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td align="left"&gt;Junior&lt;/td&gt;
    &lt;td&gt;&amp;nbsp;&lt;/td&gt;
    &lt;td align="center"
        bgcolor="red"
    &gt;
      8
    &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td align="left"&gt;Minnie&lt;/td&gt;
    &lt;td&gt;&amp;nbsp;&lt;/td&gt;
    &lt;td align="center"
    &gt;
      25
    &lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
</pre>
        <p>
          Defs can invoke other defs in the same template, and can be
          directly or indirectly recursive. Arguments to defs can be
          given default values.

      <li>
        <span class="concept">Invoking other templates</span>

        It is also possible to invoke other templates from within a
        template. Instead of supplying the def name, simply supply the
        path to the template, e.g. in <code>/img/spacer</code>:
        <pre class="template">
&lt;%args&gt;
  int width =&gt; 1;
  int height =&gt; 1;
&lt;/%args&gt;
&lt;img src="transparentpixel.gif"
     width="&lt;% width %&gt;"
     height="&lt;% height %&gt;"
     border="0"&gt;
</pre>
        This can be invoked from other templates like
        <pre class="template">
&lt;table&gt;
  &lt;tr&gt;
    &lt;td align="left"&gt;Name&lt;/td&gt;
    &lt;td&gt;&lt;& /img/spacer; width =&gt; 12 &&gt;&lt;/td&gt;
    &lt;td&gt;Age&lt;/td&gt;
  &lt;/tr&gt;
  ...
&lt;/table&gt;
</pre>

    <li><span class="concept">Fragment arguments</span>

        It is possible to pass a "fragment" of a template as an
        argument to another template (or a <code>def</code>).  When
        passing template fragments, the invocation syntax must look
        like <code>&lt;|&amp; <i>target</i>; arg1 =&gt;
        ... &amp;&gt;</code>, and any template content up until a
        closing <code>&lt;/&amp;&gt;</code> is considered the fragment
        argument.
        <p>
          In order to pass a fragment argument, the target template or
          def must declare that it expects a fragment argument. This
          is done using the <code>&lt;%farg
          <i>name</i>&gt;&lt;/%farg&gt;</code> declaration, which
          declares that the template (or def) expects a fragment
          argument.
        <p>
          The fragment can be invoked in the target template or def
          like any other template or def invocation, simply specifying
          the name of the fragment argument as the target
        <p>
          Putting this all together, the template
        <pre class="template">
&lt;%def _lilink&gt;
  &lt;%farg content&gt;
  &lt;/%farg&gt;
  &lt;%args&gt;
    String href;
  &lt;/%args&gt;
  &lt;li&gt;&lt;a href="&lt;% href %&gt;"&gt;&lt;&amp; content &amp;&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/%def&gt;

&lt;%def _big&gt;
  &lt;%farg stuff&gt;
  &lt;/%farg&gt;
&lt;font size="+4"&gt;&lt;&amp; stuff &amp;&gt;&lt;/font&gt;
&lt;/%def&gt;

&lt;ul&gt;
  &lt;|&amp; _lilink, href =&gt; "index.html" &amp;&gt;Home&lt;/&amp;&gt;
  &lt;|&amp; _lilink, href =&gt; "faq.html" &amp;&gt;&lt;bFAQ&lt;/b&gt;&lt;/&amp;&gt;
  &lt;|&amp; _lilink, href =&gt; "toc.html" &amp;&gt;&lt;&amp; _big &amp;&gt;Table of contents&lt;/&amp;&gt;
&lt;/ul&gt;
</pre>
        produces
        <pre class="tty">
&lt;ul&gt;
  &lt;li&gt;&lt;a href="index.html"&gt;Home&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="faq.html"&gt;&lt;b&gt;FAQ&lt;/b&gt;&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="toc.html"&gt;&lt;font size="+5"&gt;Table of contents&lt;/font&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</pre>

  </ol>


    <h2>Invoking templates from Java</h2>

    <ol>
      <li>
        First, make sure you have preprocessed the top-level templates
        into their Java interface equivalents.
      </li>
      <li>
        When building your project, be sure to include the generate
        interface source files in the build process.
      </li>
      <li>
        Create a TemplateManager instance (e.g. the StandardTemplateManager).
      </li>
      <li>
        Create a Writer.
      </li>
      <li>
        Then obtain an instance of the template via its Factory,
        and invoke its render method.
      </li>
    </ol>
    <h4>Example</h4>
    Suppose the template in <code>templates/foo</code> contains
    <pre class="template">
&lt;%args&gt;
  int count;
  String name => "Somebody";
  String greeting;
&lt;/%args&gt;
&lt;html&gt;
  &lt;body&gt;
%   for (int i = 1; i &lt;= count; ++i) {
    &lt;% i %&gt;. &lt; greeting &gt; &lt; name &gt; &lt;br /&gt;
%   }
  &lt;/body&gt;
&lt;/html&gt;
</pre>
    This can be processed into a Java interface with the
    <code>jamon</code> command, e.g.
  <pre class="tty">
jamon --interface --package-prefix=org.modusponens.templates --output-dir=./gensrc templates/foo
</pre>
which will place the generated Java source file(s) into the
<code>gensrc</code> directory.
<p>
You can then use the template as follows:
        <pre class="code">
import org.modusponens.templates.foo;
import org.jamon.TemplateManager;

  ...
       TemplateManager templateManager =
         new StandardTemplateManager(...);
       ...
       Writer writer = new OutputStreamWriter(System.out);
       foo.Factory factory = new foo.Factory(templateManager);
       factory.getInstance(writer)
         .setName("Duke")
         .render(3, "Hello");
</pre>
    which when executed produces the output
    <pre class="tty">
&lt;html&gt;
  &lt;body&gt;
    1. Hello Duke&lt;br /&gt;
    2. Hello Duke&lt;br /&gt;
    3. Hello Duke&lt;br /&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
    <hr>
    <address><a href="mailto:jay@contravariant.org">Jay Sachs</a></address>
  </body>
</html>
